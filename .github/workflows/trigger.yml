on:
  workflow_dispatch:
  issue_comment:
    types:
      - created

jobs:
  trigger-quality-gate:
    runs-on: ubuntu-latest
    name: Trigger quality gate correct branch
    steps:
      - uses: actions/github-script@v3
        id: get-pr
        with:
          script: |
            const request = {
              owner: context.repo.owner,
              repo: context.repo.repo,
              pull_number: context.issue.number
            }
            core.info(`Getting PR #${request.pull_number} from ${request.owner}/${request.repo}`)
            try {
              const result = await github.pulls.get(request)
              return result.data
            } catch (err) {
              core.setFailed(`Request failed with error ${err}`)
            }
      - uses: actions/checkout@v2
        with:
          repository: ${{ fromJSON(steps.get-pr.outputs.result).head.repo.full_name }}
          ref: ${{ fromJSON(steps.get-pr.outputs.result).head.sha }} # or .head.ref for branch name

    # if: contains(github.event.comment.body, 'demo-available')
    # name: Trigger that quality baby
    # uses: chillianosson/action-practice/.github/workflows/quality-gate.yml@main
    # with:
      # e2e-branch: "lets go baby"

  # demo-available:
  #   runs-on: ubuntu-latest
  #   if: contains(github.event.comment.body, 'demo-available')
  #   steps:
  #     - name: Trigger Quality Gate
  #       uses: chillianosson/action-practice/.github/workflows/quality-gate.yml@main
  #       with:
  #         e2e-branch: "Passed input data branch name from triggerrrrrrr"
  #     - name: Checkout
  #       uses: actions/checkout@v3
  #     - name: Like comment
  #       uses: actions/github-script@v4
  #       with:
  #         script: |
  #           const {owner, repo} = context.issue
  #           github.reactions.createForIssueComment({
  #             owner,
  #             repo,
  #             comment_id: context.payload.comment.id,
  #             content: "+1",
  #           });